# Midnight Metropolis Mix-up - 完全版要件定義書

## 1. ゲーム概要

**タイトル**: Midnight Metropolis Mix-up
**ジャンル**: 2Dトップダウン都市経営シミュレーション
**プラットフォーム**: HTML5/CSS/JavaScript（モダンブラウザ、デスクトップ向け）
**ターゲット**: 海外市場（英語版）

## 2. コアコンセプト

プレイヤーはネオンシティの伝説的なカクテルバー「Midnight Metropolis」のオーナーとなり、街の噂を集めて感情を込めたカクテルを作成し、顧客の心を動かし街の評判を高めていく。

### 2.1 独自要素
- **噂の錬金術**: 街の噂を材料としてカクテルを作成
- **感情システム**: 4つの感情（喜び・怒り・悲しみ・驚き）によるカクテル効果
- **ダイナミック評判**: 顧客満足度により街の評判が変化し、新たな展開が生まれる

## 3. ゲームプレイシステム

### 3.1 昼フェーズ（探索・準備）

**アクションポイント（AP）システム**
- 初期AP: 6ポイント/日
- 地区移動: -3AP
- NPC会話: -2AP  
- 闇市場購入: -1AP
- 特別イベント: -4AP

**探索可能な地区**
1. Central Park（セントラルパーク）
2. City Hall Steps（市庁舎前）
3. Back Alleys（裏路地）
4. Underground Club（地下クラブ）
5. News Agency（新聞社）
6. Black Market（闇市場）

### 3.2 夜フェーズ（バー経営）

**顧客タイプ**
1. **Regular Customer（常連客）**
   - 予測可能な好み
   - 安定した評判向上
   
2. **Tourist（観光客）**
   - ランダムなニーズ
   - 高い現金収入
   
3. **VIP Customer（VIP客）**
   - 特別条件で出現
   - レア噂を提供
   
4. **Troublemaker（トラブルメーカー）**
   - 低評判時に出現
   - 失敗すると悪評拡散

## 4. 噂システム（完全版）

### 4.1 噂の分類

**Base（核となる噂） - 6種類**
1. Mayor's Cat（市長の猫が秘密計画を聞いている）- 基礎効果: +20評判
2. Time-Traveling Fountain（中央公園の噴水はタイムマシン）- 基礎効果: +25評判
3. DJ's Dark Deal（有名DJの闇クラブ違法取引）- 基礎効果: +30評判
4. Ghost Subway Station（地下鉄の幽霊駅）- 基礎効果: +15評判
5. Rooftop Secret Meeting（高層ビル屋上の謎会合）- 基礎効果: +35評判
6. Memory Coffee（老舗カフェの記憶操作コーヒー）- 基礎効果: +40評判

**Flavor（感情・4種類）**
1. **Joy（喜び）**
   - 感情一致: +15満足度
   - 感情不一致: -8満足度
   - 特殊効果: 次回来店確率+20%

2. **Anger（怒り）**
   - 感情一致: +15満足度
   - 感情不一致: -10満足度
   - 特殊効果: トラブルメーカー化阻止

3. **Sorrow（悲しみ）**
   - 感情一致: +15満足度
   - 感情不一致: -6満足度
   - 特殊効果: 特別アイテム獲得チャンス

4. **Surprise（驚き）**
   - 感情一致: +18満足度
   - 感情不一致: -5満足度
   - 特殊効果: 隠しレシピ発見率+10%

**Garnish（装飾・詳細） - 4種類**
1. Witness Testimony（目撃者証言あり）- 効果持続+1日
2. Midnight Only（午前2時限定現象）- 効果+20%
3. Black Market Gossip（闇市場の噂）- 現金収入+30%
4. Mysterious Note（謎のメモ発見）- 新噂獲得率+15%

### 4.2 レア度システム

| レア度 | 基礎効果倍率 | 有効期限 | 入手確率 |
|--------|-------------|----------|----------|
| Common | 1.0倍 | 3日 | 70% |
| Rare | 1.5倍 | 5日 | 20% |
| Epic | 2.0倍 | 7日 | 8% |
| Legendary | 3.0倍 | 10日 | 2% |

## 5. 顧客満足度・評判システム

### 5.1 満足度計算式

**基本満足度 = Base効果 + Flavor効果 + Garnish効果 + シナジーボーナス**

**シナジーボーナス**
- 完全感情一致: +25%
- 特殊レシピ発動: +50%
- レア度ボーナス: レア度倍率適用

### 5.2 評判変換

満足度80-100: 評判+8～+10
満足度60-79: 評判+3～+5
満足度40-59: 評判±0
満足度20-39: 評判-3～-5
満足度0-19: 評判-8～-10

### 5.3 評判による影響

| 評判レベル | 範囲 | VIP出現率 | トラブル出現率 | 特殊効果 |
|------------|------|-----------|---------------|----------|
| Legendary | 90-100 | 25% | 0% | 秘密レシピ解放 |
| High | 70-89 | 15% | 5% | レア噂入手率+20% |
| Medium | 40-69 | 8% | 10% | 通常営業 |
| Low | 20-39 | 2% | 25% | 悪評イベント発生 |
| Terrible | 0-19 | 0% | 40% | 営業妨害イベント |

## 6. 特殊レシピシステム

### 6.1 隠しレシピ（5種類）

1. **Mayor's Time Cat** 
   - 組み合わせ: Mayor's Cat + Joy + Witness Testimony
   - 効果: 満足度+45、評判+15、VIP出現率+10%

2. **Midnight Fountain Shock**
   - 組み合わせ: Time-Traveling Fountain + Surprise + Midnight Only  
   - 効果: 満足度+50、新噂2個自動獲得

3. **Angry DJ's Secret**
   - 組み合わせ: DJ's Dark Deal + Anger + Black Market Gossip
   - 効果: 満足度+40、現金収入+100%

4. **Sorrowful Memory**
   - 組み合わせ: Memory Coffee + Sorrow + Mysterious Note
   - 効果: 満足度+35、特別アイテム確定獲得

5. **Ghost Surprise**
   - 組み合わせ: Ghost Subway Station + Surprise + Midnight Only
   - 効果: 満足度+60、レジェンダリー噂獲得チャンス

## 7. 1日シミュレーション例（バランス確認済み）

### 昼フェーズ（AP6）
1. Central Park移動（-3AP）→ NPC会話（-2AP）→ Common噂「Mayor's Cat」獲得
2. Black Market購入（-1AP）→ Rare噂「Time-Traveling Fountain」獲得
3. AP消費完了 → 夜フェーズへ

### 夜フェーズ（評判50開始）
**顧客1: Alice（常連、気分:Joy）**
- 提供: Mayor's Cat + Joy + なし
- 満足度: 20(Base) + 15(Flavor一致) = 35 → 評判+3

**顧客2: Bob（観光客、気分:Surprise）**
- 提供: Time-Traveling Fountain + Surprise + なし
- 満足度: 25(Base×1.5倍) + 18(Flavor一致) = 43 → 評判+3

**顧客3: Charlie（トラブル、気分:Anger）**
- 提供ミス: Mayor's Cat + Joy（感情不一致）
- 満足度: 20(Base) - 8(不一致) = 12 → 評判-8

**終了時評判: 50 + 3 + 3 - 8 = 48**

## 8. 技術仕様

### 8.1 アーキテクチャ
- **ES Modules**による モジュール構造
- **MVC パターン**でコード分離
- **JSON**による データ管理

### 8.2 ファイル構造
```
/src
  /modules
    - gameEngine.js (メインゲームループ)
    - rumorSystem.js (噂管理)
    - customerSystem.js (顧客管理)
    - reputationSystem.js (評判管理)
    - uiController.js (UI制御)
  /data
    - rumors.json (噂データベース)
    - customers.json (顧客データ)
    - recipes.json (特殊レシピ)
  /assets
    - sprites/ (2D画像)
    - audio/ (効果音・BGM)
```

### 8.3 パフォーマンス目標
- **30FPS以上**維持
- **メモリ使用量**100MB以下
- **ロード時間**5秒以内

## 9. UI設計

### 9.1 昼フェーズUI
- **シティマップ**（クリック移動）
- **APゲージ**（残りポイント表示）
- **噂インベントリ**（収集済み表示）

### 9.2 夜フェーズUI  
- **バートップビュー**（2Dトップダウン）
- **顧客キュー**（待機リスト）
- **噂ボード**（ドラッグ&ドロップ）
- **満足度メーター**（リアルタイム）

## 10. 開発スケジュール（推奨）

**フェーズ1（2週間）**: コアシステム実装
- ゲームループ
- 噂システム基礎
- 基本UI

**フェーズ2（2週間）**: ゲームプレイ実装  
- 顧客システム
- カクテル作成
- 評判システム

**フェーズ3（1週間）**: バランス調整・テスト
- 数値調整
- バグ修正
- UI改善

**フェーズ4（1週間）**: 最終仕上げ
- 効果音・BGM
- 海外向けローカライゼーション
- 最終テスト