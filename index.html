<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Midnight Metropolis Memory Mix-up</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #e94560;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* èªè¨¼ç”»é¢ */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-modal {
            background: linear-gradient(135deg, #16213e, #0f3460);
            padding: 2rem;
            border-radius: 15px;
            border: 2px solid #e94560;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .auth-modal h2 {
            color: #f39c12;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .auth-options {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .auth-btn {
            flex: 1;
            padding: 1rem;
            border: 2px solid #e94560;
            background: transparent;
            color: #e94560;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .auth-btn:hover {
            background: #e94560;
            color: white;
            transform: translateY(-2px);
        }

        .premium-info {
            background: rgba(249, 156, 18, 0.1);
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border: 1px solid #f39c12;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #e94560;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .game-title {
            font-size: 1.5rem;
            color: #f39c12;
            text-shadow: 0 0 10px #f39c12;
        }

        .currency-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(249, 156, 18, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid #f39c12;
        }

        .coin-icon {
            color: #f39c12;
            font-size: 1.2rem;
        }

        .currency-amount {
            color: #f39c12;
            font-weight: bold;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .speed-btn {
            padding: 0.3rem 0.6rem;
            border: 1px solid #e94560;
            background: transparent;
            color: #e94560;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .speed-btn.active {
            background: #e94560;
            color: white;
        }

        .satisfaction-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .satisfaction-bar {
            width: 100px;
            height: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            overflow: hidden;
        }

        .satisfaction-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #2ecc71);
            transition: width 0.3s;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ç”»é¢ */
        .game-container {
            display: flex;
            height: calc(100vh - 80px);
        }

        .game-area {
            flex: 1;
            padding: 1rem;
            overflow: hidden;
        }

        .buildings-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            height: 100%;
            max-height: 600px;
        }

        .building {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #e94560;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            min-height: 120px;
        }

        .building:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(233, 69, 96, 0.3);
        }

        .building-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .building-info {
            text-align: center;
            font-size: 0.8rem;
        }

        .memory-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.7rem;
            background: rgba(0, 0, 0, 0.7);
            padding: 2px 5px;
            border-radius: 3px;
        }

        /* å³ãƒ‘ãƒãƒ« */
        .right-panel {
            width: 300px;
            background: rgba(0, 0, 0, 0.2);
            border-left: 2px solid #e94560;
            display: flex;
            flex-direction: column;
        }

        .panel-tabs {
            display: flex;
            border-bottom: 1px solid #e94560;
        }

        .panel-tab {
            flex: 1;
            padding: 0.8rem;
            background: transparent;
            border: none;
            color: #e94560;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-size: 0.9rem;
        }

        .panel-tab.active {
            border-bottom-color: #f39c12;
            color: #f39c12;
        }

        .panel-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        /* ã‚·ãƒ§ãƒƒãƒ— */
        .shop-category {
            margin-bottom: 2rem;
        }

        .shop-category h3 {
            color: #f39c12;
            margin-bottom: 1rem;
            border-bottom: 1px solid #f39c12;
            padding-bottom: 0.5rem;
        }

        .shop-items {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .shop-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.8rem;
            border-radius: 8px;
            border: 1px solid #e94560;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shop-item:hover {
            background: rgba(233, 69, 96, 0.1);
            transform: translateX(5px);
        }

        .shop-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.3rem;
        }

        .shop-item-name {
            color: #f39c12;
            font-weight: bold;
        }

        .shop-item-price {
            color: #2ecc71;
            font-size: 0.9rem;
        }

        .shop-item-desc {
            font-size: 0.8rem;
            color: #bbb;
        }

        .shop-item-duration {
            font-size: 0.7rem;
            color: #e94560;
            margin-top: 0.2rem;
        }

        /* ãƒ©ãƒ³ã‚­ãƒ³ã‚° */
        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .ranking-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.8rem;
            border-radius: 8px;
            border: 1px solid #e94560;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ranking-item.player {
            background: rgba(249, 156, 18, 0.2);
            border-color: #f39c12;
            box-shadow: 0 0 10px rgba(249, 156, 18, 0.3);
        }

        .ranking-rank {
            font-weight: bold;
            color: #f39c12;
            min-width: 30px;
        }

        .ranking-player {
            flex: 1;
            margin: 0 0.5rem;
        }

        .ranking-score {
            color: #2ecc71;
            font-weight: bold;
        }

        /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .active-effects {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .effect-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.8rem;
            border-radius: 8px;
            border: 1px solid #2ecc71;
        }

        .effect-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.3rem;
        }

        .effect-name {
            color: #2ecc71;
            font-weight: bold;
        }

        .effect-timer {
            color: #f39c12;
            font-size: 0.9rem;
        }

        .effect-desc {
            font-size: 0.8rem;
            color: #bbb;
        }

        .effect-progress {
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .effect-progress-fill {
            height: 100%;
            background: #2ecc71;
            transition: width 0.1s;
        }

        /* ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ  */
        .particle {
            position: absolute;
            pointer-events: none;
            font-size: 1rem;
            animation: float-up 2s ease-out forwards;
        }

        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 1024px) {
            .buildings-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }
            
            .right-panel {
                width: 250px;
            }
        }

        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }
            
            .right-panel {
                width: 100%;
                height: 300px;
            }
            
            .buildings-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(6, 1fr);
            }
        }

        /* ãƒ¡ãƒ¢ãƒªãƒ¼ã‚¿ã‚¤ãƒ— */
        .memory-happiness { color: #f39c12; }
        .memory-skill { color: #3498db; }
        .memory-emotion { color: #e74c3c; }
        .memory-knowledge { color: #2ecc71; }
        .memory-experience { color: #9b59b6; }
    </style>
</head>
<body>
    <!-- èªè¨¼ç”»é¢ -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-modal">
            <h2>ğŸŒƒ Midnight Metropolis Memory Mix-up</h2>
            <p>è¨˜æ†¶ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆã¨ã—ã¦éƒ½å¸‚ã®è¨˜æ†¶ã‚’ç®¡ç†ã—ã¾ã—ã‚‡ã†</p>
            
            <div class="premium-info">
                <h4>ğŸ® ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½</h4>
                <ul style="text-align: left; margin-top: 0.5rem;">
                    <li>ğŸ† ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ©ãƒ³ã‚­ãƒ³ã‚°å‚åŠ </li>
                    <li>ğŸ›ï¸ å…¨ã‚·ãƒ§ãƒƒãƒ—ã‚¢ã‚¤ãƒ†ãƒ åˆ©ç”¨å¯èƒ½</li>
                    <li>ğŸ’¾ é€²æ—è‡ªå‹•ä¿å­˜</li>
                    <li>â° ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€²è¡Œæ©Ÿèƒ½</li>
                </ul>
            </div>
            
            <div class="auth-options">
                <button class="auth-btn" onclick="startGame(false)">
                    ğŸ­ ã‚²ã‚¹ãƒˆã§ãƒ—ãƒ¬ã‚¤<br>
                    <small>åŸºæœ¬æ©Ÿèƒ½ã®ã¿</small>
                </button>
                <button class="auth-btn" onclick="startGame(true)">
                    ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²<br>
                    <small>å…¨æ©Ÿèƒ½åˆ©ç”¨å¯èƒ½</small>
                </button>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div class="game-screen" id="gameScreen" style="display: none;">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <div class="header-left">
                <div class="game-title">ğŸŒƒ Memory Metropolis</div>
                <div class="currency-display">
                    <span class="coin-icon">ğŸª™</span>
                    <span class="currency-amount" id="currencyAmount">0</span>
                </div>
                <div class="satisfaction-display">
                    <span>æº€è¶³åº¦:</span>
                    <div class="satisfaction-bar">
                        <div class="satisfaction-fill" id="satisfactionFill" style="width: 0%"></div>
                    </div>
                    <span id="satisfactionPercent">0%</span>
                </div>
            </div>
            <div class="header-controls">
                <div class="speed-control">
                    <span>é€Ÿåº¦:</span>
                    <button class="speed-btn active" onclick="setGameSpeed(1)">1x</button>
                    <button class="speed-btn" onclick="setGameSpeed(2)">2x</button>
                    <button class="speed-btn" onclick="setGameSpeed(3)">3x</button>
                </div>
                <div id="userInfo"></div>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
        <div class="game-container">
            <div class="game-area">
                <div class="buildings-grid" id="buildingsGrid">
                    <!-- å»ºç‰©ã¯å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>

            <!-- å³ãƒ‘ãƒãƒ« -->
            <div class="right-panel">
                <div class="panel-tabs">
                    <button class="panel-tab active" onclick="switchTab('shop')">ğŸ›ï¸ ã‚·ãƒ§ãƒƒãƒ—</button>
                    <button class="panel-tab" onclick="switchTab('ranking')">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
                    <button class="panel-tab" onclick="switchTab('effects')">âš¡ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ</button>
                </div>

                <div class="panel-content">
                    <!-- ã‚·ãƒ§ãƒƒãƒ—ã‚¿ãƒ– -->
                    <div id="shopTab" class="tab-content">
                        <div class="shop-category">
                            <h3>ğŸš€ åŠ¹ç‡ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼</h3>
                            <div class="shop-items">
                                <div class="shop-item" onclick="buyItem('boost', 5, 50)">
                                    <div class="shop-item-header">
                                        <span class="shop-item-name">ã‚¯ã‚¤ãƒƒã‚¯ãƒ–ãƒ¼ã‚¹ãƒˆ</span>
                                        <span class="shop-item-price">ğŸª™50</span>
                                    </div>
                                    <div class="shop-item-desc">è¨˜æ†¶ç”Ÿæˆé€Ÿåº¦Ã—1.5ã€å»ºç‰©å®¹é‡Ã—1.5ã€é€šè²¨åå…¥Ã—2</div>
                                    <div class="shop-item-duration">æŒç¶šæ™‚é–“: 5åˆ†</div>
                                </div>
                                <div class="shop-item" onclick="buyItem('boost', 10, 90)">
                                    <div class="shop-item-header">
                                        <span class="shop-item-name">ãƒ‘ãƒ¯ãƒ¼ãƒ–ãƒ¼ã‚¹ãƒˆ</span>
                                        <span class="shop-item-price">ğŸª™90</span>
                                    </div>
                                    <div class="shop-item-desc">è¨˜æ†¶ç”Ÿæˆé€Ÿåº¦Ã—1.5ã€å»ºç‰©å®¹é‡Ã—1.5ã€é€šè²¨åå…¥Ã—2</div>
                                    <div class="shop-item-duration">æŒç¶šæ™‚é–“: 10åˆ†</div>
                                </div>
                                <div class="shop-item" onclick="buyItem('boost', 30, 200)">
                                    <div class="shop-item-header">
                                        <span class="shop-item-name">ãƒ¡ã‚¬ãƒ–ãƒ¼ã‚¹ãƒˆ</span>
                                        <span class="shop-item-price">ğŸª™200</span>
                                    </div>
                                    <div class="shop-item-desc">è¨˜æ†¶ç”Ÿæˆé€Ÿåº¦Ã—1.5ã€å»ºç‰©å®¹é‡Ã—1.5ã€é€šè²¨åå…¥Ã—2</div>
                                    <div class="shop-item-duration">æŒç¶šæ™‚é–“: 30åˆ†</div>
                                </div>
                            </div>
                        </div>

                        <div class="shop-category">
                            <h3>ğŸ¤– ãƒ¡ãƒ¢ãƒªãƒ¼ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h3>
                            <div class="shop-items">
                                <div class="shop-item" onclick="buyItem('assistant', 5, 75)">
                                    <div class="shop-item-header">
                                        <span class="shop-item-name">AI ã‚¢ã‚·ã‚¹ãƒˆ S</span>
                                        <span class="shop-item-price">ğŸª™75</span>
                                    </div>
                                    <div class="shop-item-desc">è‡ªå‹•è¨˜æ†¶é…å¸ƒã€å®Œå…¨AIç®¡ç†</div>
                                    <div class="shop-item-duration">æŒç¶šæ™‚é–“: 5åˆ†</div>
                                </div>
                                <div class="shop-item" onclick="buyItem('assistant', 10, 130)">
                                    <div class="shop-item-header">
                                        <span class="shop-item-name">AI ã‚¢ã‚·ã‚¹ãƒˆ M</span>
                                        <span class="shop-item-price">ğŸª™130</span>
                                    </div>
                                    <div class="shop-item-desc">è‡ªå‹•è¨˜æ†¶é…å¸ƒã€å®Œå…¨AIç®¡ç†</div>
                                    <div class="shop-item-duration">æŒç¶šæ™‚é–“: 10åˆ†</div>
                                </div>
                                <div class="shop-item" onclick="buyItem('assistant', 30, 300)">
                                    <div class="shop-item-header">
                                        <span class="shop-item-name">AI ã‚¢ã‚·ã‚¹ãƒˆ L</span>
                                        <span class="shop-item-price">ğŸª™300</span>
                                    </div>
                                    <div class="shop-item-desc">è‡ªå‹•è¨˜æ†¶é…å¸ƒã€å®Œå…¨AIç®¡ç†</div>
                                    <div class="shop-item-duration">æŒç¶šæ™‚é–“: 30åˆ†</div>
                                </div>
                            </div>
                        </div>

                        <div class="shop-category">
                            <h3>â° ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€²è¡Œ</h3>
                            <div class="shop-items">
                                <div class="shop-item" onclick="buyItem('offline', 60, 100)">
                                    <div class="shop-item-header">
                                        <span class="shop-item-name">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€²è¡Œ S</span>
                                        <span class="shop-item-price">ğŸª™100</span>
                                    </div>
                                    <div class="shop-item-desc">ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã‚‚é€²è¡Œç¶™ç¶šã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åç›Šè¨ˆç®—</div>
                                    <div class="shop-item-duration">æŒç¶šæ™‚é–“: 1æ™‚é–“</div>
                                </div>
                                <div class="shop-item" onclick="buyItem('offline', 180, 250)">
                                    <div class="shop-item-header">
                                        <span class="shop-item-name">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€²è¡Œ M</span>
                                        <span class="shop-item-price">ğŸª™250</span>
                                    </div>
                                    <div class="shop-item-desc">ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã‚‚é€²è¡Œç¶™ç¶šã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åç›Šè¨ˆç®—</div>
                                    <div class="shop-item-duration">æŒç¶šæ™‚é–“: 3æ™‚é–“</div>
                                </div>
                                <div class="shop-item" onclick="buyItem('offline', 300, 400)">
                                    <div class="shop-item-header">
                                        <span class="shop-item-name">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€²è¡Œ L</span>
                                        <span class="shop-item-price">ğŸª™400</span>
                                    </div>
                                    <div class="shop-item-desc">ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã‚‚é€²è¡Œç¶™ç¶šã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åç›Šè¨ˆç®—</div>
                                    <div class="shop-item-duration">æŒç¶šæ™‚é–“: 5æ™‚é–“</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¿ãƒ– -->
                    <div id="rankingTab" class="tab-content" style="display: none;">
                        <div class="ranking-list" id="rankingList">
                            <div class="ranking-item">
                                <span class="ranking-rank">1</span>
                                <span class="ranking-player">MemoryMaster</span>
                                <span class="ranking-score">15,420</span>
                            </div>
                            <div class="ranking-item">
                                <span class="ranking-rank">2</span>
                                <span class="ranking-player">CityArchitect</span>
                                <span class="ranking-score">12,890</span>
                            </div>
                            <div class="ranking-item">
                                <span class="ranking-rank">3</span>
                                <span class="ranking-player">NightBuilder</span>
                                <span class="ranking-score">11,230</span>
                            </div>
                            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                        </div>
                    </div>

                    <!-- ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¿ãƒ– -->
                    <div id="effectsTab" class="tab-content" style="display: none;">
                        <div class="active-effects" id="activeEffects">
                            <p style="color: #888; text-align: center;">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            isRegistered: false,
            playerId: null,
            currency: 0,
            satisfaction: 0,
            buildings: [],
            activeEffects: [],
            gameSpeed: 1,
            lastUpdate: Date.now(),
            isOffline: false
        };

        // ãƒ¡ãƒ¢ãƒªãƒ¼ã‚¿ã‚¤ãƒ—å®šç¾©
        const memoryTypes = {
            happiness: { icon: 'ğŸ˜Š', color: '#f39c12', name: 'å¹¸ç¦' },
            skill: { icon: 'ğŸ› ï¸', color: '#3498db', name: 'æŠ€èƒ½' },
            emotion: { icon: 'â¤ï¸', color: '#e74c3c', name: 'æ„Ÿæƒ…' },
            knowledge: { icon: 'ğŸ“š', color: '#2ecc71', name: 'çŸ¥è­˜' },
            experience: { icon: 'ğŸŒŸ', color: '#9b59b6', name: 'çµŒé¨“' }
        };

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
        let rankingData = [
            { id: 'MemoryMaster', score: 15420 },
            { id: 'CityArchitect', score: 12890 },
            { id: 'NightBuilder', score: 11230 },
            { id: 'DreamWeaver', score: 9800 },
            { id: 'ThoughtKeeper', score: 8750 },
            { id: 'MindPalace', score: 7650 },
            { id: 'RecallWizard', score: 6890 },
            { id: 'MemoryBank', score: 5340 },
            { id: 'CognitiveCorp', score: 4120 },
            { id: 'BrainStorm', score: 3450 }
        ];

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame(isRegistered) {
            gameState.isRegistered = isRegistered;
            
            if (isRegistered) {
                gameState.playerId = 'Player_' + Math.random().toString(36).substr(2, 9);
                document.getElementById('userInfo').innerHTML = `ğŸ‘¤ ${gameState.playerId}`;
                // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«è¿½åŠ 
                rankingData.push({ id: gameState.playerId, score: 0 });
            } else {
                document.getElementById('userInfo').innerHTML = 'ğŸ­ ã‚²ã‚¹ãƒˆ';
            }

            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            initializeGame();
        }

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initializeGame() {
            createBuildings();
            startGameLoop();
            
            // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€²è¡Œãƒã‚§ãƒƒã‚¯
            if (gameState.isRegistered) {
                checkOfflineProgress();
            }
        }

        // å»ºç‰©ç”Ÿæˆ
        function createBuildings() {
            const grid = document.getElementById('buildingsGrid');
            grid.innerHTML = '';
            
            const types = Object.keys(memoryTypes);
            
            for (let i = 0; i < 18; i++) {
                const building = document.createElement('div');
                building.className = 'building';
                building.dataset.index = i;
                
                const type = types[i % types.length];
                const memoryType = memoryTypes[type];
                
                const buildingData = {
                    type: type,
                    memories: 0,
                    maxMemories: 10,
                    satisfaction: 0,
                    residents: Math.floor(Math.random() * 5) + 3
                };
                
                gameState.buildings[i] = buildingData;
                
                building.innerHTML = `
                    <div class="building-icon" style="color: ${memoryType.color}">
                        ${memoryType.icon}
                    </div>
                    <div class="building-info">
                        <div>${memoryType.name}è¨˜æ†¶åº«</div>
                        <div>ä½æ°‘: ${buildingData.residents}</div>
                    </div>
                    <div class="memory-indicator">
                        <span id="memory-${i}">${buildingData.memories}/${buildingData.maxMemories}</span>
                    </div>
                `;
                
                building.addEventListener('click', () => clickBuilding(i));
                grid.appendChild(building);
            }
        }

        // å»ºç‰©ã‚¯ãƒªãƒƒã‚¯
        function clickBuilding(index) {
            const building = gameState.buildings[index];
            const memoryBoost = hasActiveEffect('boost') ? 1.5 : 1;
            const capacityBoost = hasActiveEffect('boost') ? 1.5 : 1;
            
            if (building.memories < building.maxMemories * capacityBoost) {
                building.memories += Math.ceil(1 * memoryBoost * gameState.gameSpeed);
                building.memories = Math.min(building.memories, building.maxMemories * capacityBoost);
                updateBuildingDisplay(index);
                
                // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ
                createParticle(event.target, memoryTypes[building.type].icon);
            }
        }

        // å»ºç‰©è¡¨ç¤ºæ›´æ–°
        function updateBuildingDisplay(index) {
            const building = gameState.buildings[index];
            const capacityBoost = hasActiveEffect('boost') ? 1.5 : 1;
            const maxCapacity = Math.floor(building.maxMemories * capacityBoost);
            
            document.getElementById(`memory-${index}`).textContent = 
                `${building.memories}/${maxCapacity}`;
        }

        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆ
        function createParticle(element, icon) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = icon;
            particle.style.left = Math.random() * 50 + 'px';
            particle.style.top = Math.random() * 50 + 'px';
            
            element.appendChild(particle);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 2000);
        }

        // ã‚²ãƒ¼ãƒ ã‚¹ãƒ”ãƒ¼ãƒ‰è¨­å®š
        function setGameSpeed(speed) {
            gameState.gameSpeed = speed;
            
            document.querySelectorAll('.speed-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            if (tabName === 'ranking') {
                updateRanking();
            }
        }

        // ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥
        function buyItem(type, duration, price) {
            if (!gameState.isRegistered && type !== 'boost') {
                alert('ã“ã®æ©Ÿèƒ½ã¯ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™');
                return;
            }
            
            if (gameState.currency >= price) {
                gameState.currency -= price;
                addActiveEffect(type, duration);
                updateCurrencyDisplay();
                updateActiveEffects();
            } else {
                alert('é€šè²¨ãŒä¸è¶³ã—ã¦ã„ã¾ã™');
            }
        }

        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¿½åŠ 
        function addActiveEffect(type, duration) {
            const effects = {
                boost: { name: 'åŠ¹ç‡ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼', desc: 'è¨˜æ†¶ç”ŸæˆÃ—1.5ã€å»ºç‰©å®¹é‡Ã—1.5ã€é€šè²¨åå…¥Ã—2', icon: 'ğŸš€' },
                assistant: { name: 'ãƒ¡ãƒ¢ãƒªãƒ¼ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ', desc: 'è‡ªå‹•è¨˜æ†¶é…å¸ƒã€å®Œå…¨AIç®¡ç†', icon: 'ğŸ¤–' },
                offline: { name: 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€²è¡Œ', desc: 'ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã‚‚é€²è¡Œç¶™ç¶š', icon: 'â°' }
            };
            
            const effect = {
                type: type,
                name: effects[type].name,
                desc: effects[type].desc,
                icon: effects[type].icon,
                duration: duration * 60, // åˆ†ã‚’ç§’ã«å¤‰æ›
                startTime: Date.now()
            };
            
            // åŒã˜ã‚¿ã‚¤ãƒ—ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤
            gameState.activeEffects = gameState.activeEffects.filter(e => e.type !== type);
            gameState.activeEffects.push(effect);
        }

        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç¢ºèª
        function hasActiveEffect(type) {
            return gameState.activeEffects.some(effect => effect.type === type);
        }

        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆæ›´æ–°
        function updateActiveEffects() {
            const container = document.getElementById('activeEffects');
            
            if (gameState.activeEffects.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center;">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            container.innerHTML = '';
            
            gameState.activeEffects.forEach((effect, index) => {
                const now = Date.now();
                const elapsed = (now - effect.startTime) / 1000;
                const remaining = Math.max(0, effect.duration - elapsed);
                const progress = Math.max(0, (effect.duration - elapsed) / effect.duration * 100);
                
                if (remaining <= 0) {
                    gameState.activeEffects.splice(index, 1);
                    return;
                }
                
                const minutes = Math.floor(remaining / 60);
                const seconds = Math.floor(remaining % 60);
                
                const effectElement = document.createElement('div');
                effectElement.className = 'effect-item';
                effectElement.innerHTML = `
                    <div class="effect-header">
                        <span class="effect-name">${effect.icon} ${effect.name}</span>
                        <span class="effect-timer">${minutes}:${seconds.toString().padStart(2, '0')}</span>
                    </div>
                    <div class="effect-desc">${effect.desc}</div>
                    <div class="effect-progress">
                        <div class="effect-progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
                
                container.appendChild(effectElement);
            });
        }

        // é€šè²¨è¡¨ç¤ºæ›´æ–°
        function updateCurrencyDisplay() {
            document.getElementById('currencyAmount').textContent = Math.floor(gameState.currency);
        }

        // æº€è¶³åº¦è¡¨ç¤ºæ›´æ–°
        function updateSatisfactionDisplay() {
            const satisfactionPercent = Math.floor(gameState.satisfaction);
            document.getElementById('satisfactionFill').style.width = satisfactionPercent + '%';
            document.getElementById('satisfactionPercent').textContent = satisfactionPercent + '%';
        }

        // ã‚¹ã‚³ã‚¢è¨ˆç®—
        function calculateScore() {
            let satisfiedResidents = 0;
            gameState.buildings.forEach(building => {
                if (building.memories >= building.residents) {
                    satisfiedResidents += building.residents;
                }
            });
            
            return satisfiedResidents * 10 + gameState.satisfaction * 2 + gameState.currency * 0.1;
        }

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ›´æ–°
        function updateRanking() {
            if (!gameState.isRegistered) {
                document.getElementById('rankingList').innerHTML = 
                    '<p style="color: #888; text-align: center;">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™</p>';
                return;
            }
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¹ã‚³ã‚¢æ›´æ–°
            const playerScore = calculateScore();
            const playerIndex = rankingData.findIndex(entry => entry.id === gameState.playerId);
            if (playerIndex !== -1) {
                rankingData[playerIndex].score = playerScore;
            }
            
            // ã‚½ãƒ¼ãƒˆ
            rankingData.sort((a, b) => b.score - a.score);
            
            // è¡¨ç¤ºæ›´æ–°
            const container = document.getElementById('rankingList');
            container.innerHTML = '';
            
            // ãƒˆãƒƒãƒ—10 + ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
            const displayData = rankingData.slice(0, 10);
            const playerRank = rankingData.findIndex(entry => entry.id === gameState.playerId) + 1;
            
            displayData.forEach((entry, index) => {
                const isPlayer = entry.id === gameState.playerId;
                const rankElement = document.createElement('div');
                rankElement.className = isPlayer ? 'ranking-item player' : 'ranking-item';
                rankElement.innerHTML = `
                    <span class="ranking-rank">${index + 1}</span>
                    <span class="ranking-player">${entry.id}</span>
                    <span class="ranking-score">${Math.floor(entry.score)}</span>
                `;
                container.appendChild(rankElement);
            });
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ10ä½ä»¥ä¸‹ã®å ´åˆã¯åˆ¥é€”è¡¨ç¤º
            if (playerRank > 10) {
                const separatorElement = document.createElement('div');
                separatorElement.innerHTML = '<hr style="margin: 0.5rem 0; border-color: #e94560;">';
                container.appendChild(separatorElement);
                
                const playerEntry = rankingData.find(entry => entry.id === gameState.playerId);
                const playerElement = document.createElement('div');
                playerElement.className = 'ranking-item player';
                playerElement.innerHTML = `
                    <span class="ranking-rank">${playerRank}</span>
                    <span class="ranking-player">${playerEntry.id}</span>
                    <span class="ranking-score">${Math.floor(playerEntry.score)}</span>
                `;
                container.appendChild(playerElement);
            }
        }

        // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€²è¡Œãƒã‚§ãƒƒã‚¯
        function checkOfflineProgress() {
            const lastSave = localStorage.getItem('lastSaveTime');
            if (lastSave) {
                const offlineTime = (Date.now() - parseInt(lastSave)) / 1000; // ç§’
                if (offlineTime > 60) { // 1åˆ†ä»¥ä¸Šã‚ªãƒ•ãƒ©ã‚¤ãƒ³
                    const offlineMinutes = Math.floor(offlineTime / 60);
                    const offlineReward = Math.floor(offlineMinutes * 10); // åˆ†ã‚ãŸã‚Š10é€šè²¨
                    
                    gameState.currency += offlineReward;
                    alert(`ãŠã‹ãˆã‚Šãªã•ã„ï¼\nã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚é–“: ${offlineMinutes}åˆ†\nç²å¾—é€šè²¨: ${offlineReward}`);
                }
            }
        }

        // ã‚²ãƒ¼ãƒ ä¿å­˜
        function saveGame() {
            if (gameState.isRegistered) {
                localStorage.setItem('gameState', JSON.stringify(gameState));
                localStorage.setItem('lastSaveTime', Date.now().toString());
            }
        }

        // AIè‡ªå‹•ç®¡ç†
        function autoManageMemories() {
            if (!hasActiveEffect('assistant')) return;
            
            gameState.buildings.forEach((building, index) => {
                const capacityBoost = hasActiveEffect('boost') ? 1.5 : 1;
                const maxCapacity = Math.floor(building.maxMemories * capacityBoost);
                
                if (building.memories < maxCapacity) {
                    building.memories = Math.min(building.memories + 1, maxCapacity);
                    updateBuildingDisplay(index);
                }
            });
        }

        // ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
        function startGameLoop() {
            setInterval(() => {
                const now = Date.now();
                const deltaTime = (now - gameState.lastUpdate) / 1000 * gameState.gameSpeed;
                gameState.lastUpdate = now;
                
                // AIè‡ªå‹•ç®¡ç†
                autoManageMemories();
                
                // æº€è¶³åº¦è¨ˆç®—
                let totalSatisfaction = 0;
                let satisfiedBuildings = 0;
                
                gameState.buildings.forEach(building => {
                    if (building.memories >= building.residents) {
                        building.satisfaction = 100;
                        satisfiedBuildings++;
                    } else {
                        building.satisfaction = (building.memories / building.residents) * 100;
                    }
                    totalSatisfaction += building.satisfaction;
                });
                
                gameState.satisfaction = totalSatisfaction / gameState.buildings.length;
                
                // é€šè²¨ç²å¾—ï¼ˆæº€è¶³åº¦ãƒ™ãƒ¼ã‚¹ï¼‰
                const currencyMultiplier = hasActiveEffect('boost') ? 2 : 1;
                const currencyGain = (gameState.satisfaction / 100) * deltaTime * 10 * currencyMultiplier;
                gameState.currency += currencyGain;
                
                // è¡¨ç¤ºæ›´æ–°
                updateCurrencyDisplay();
                updateSatisfactionDisplay();
                updateActiveEffects();
                
                // å®šæœŸä¿å­˜
                if (Math.random() < 0.01) { // 1%ã®ç¢ºç‡ã§ä¿å­˜
                    saveGame();
                }
                
            }, 100); // 100msé–“éš”
        }

        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ä¿å­˜
        window.addEventListener('beforeunload', saveGame);
        
        // ãƒšãƒ¼ã‚¸éè¡¨ç¤ºæ™‚ã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && hasActiveEffect('offline')) {
                gameState.isOffline = true;
            } else {
                gameState.isOffline = false;
            }
        });
    </script>
</body>
</html>